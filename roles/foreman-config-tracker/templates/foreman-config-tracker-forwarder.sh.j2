#!/usr/bin/env bash
# /usr/local/bin/foreman-config-forwarder.sh
# ==========================================
# Temporary debug forwarder for auditd dispatcher
# Logs raw events received from auditd for testing.

LOG_FILE="{{ log_file_path }}"

# Ensure log file exists
mkdir -p "$(dirname "$LOG_FILE")"
touch "$LOG_FILE"
chmod 640 "$LOG_FILE"

echo "[$(date -u '+%Y-%m-%dT%H:%M:%SZ')] [INFO] foreman-config-tracker-forwarder.sh started (PID $$)" >> "$LOG_FILE"

# Read from stdin (auditd dispatcher stream)
while IFS= read -r line; do
  ts="$(date -u '+%Y-%m-%dT%H:%M:%SZ')"
  echo "[$ts] $line" >> "$LOG_FILE"
done
